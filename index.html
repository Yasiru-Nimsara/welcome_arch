<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Map + Route demo</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css"/>

<style>
  html,body,#map { height: 100%; margin: 0; padding: 0; }
  #controls {
    position: absolute;
    left: 10px;
    top: 10px;
    z-index: 1000;
    background: rgba(255,255,255,0.95);
    padding: 8px;
    border-radius: 6px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    min-width: 140px;
  }
  .place-btn {
    display:block;
    width:100%;
    margin:6px 0;
    padding:6px 8px;
    border-radius:4px;
    border:1px solid #ccc;
    background:#f7f7f7;
    cursor:pointer;
    text-align:left;
  }
</style>
</head>
<body>
<div id="map"></div>
<div id="controls"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

<script>
// Replace or extend this list with whatever places you want (names + coordinates)
const places = [
  { name: "Coffee Shop", lat: 40.741895, lng: -73.989308 },
  { name: "Museum",       lat: 40.779437, lng: -73.963244 },
  { name: "Train Station",lat: 40.752726, lng: -73.977229 }
];

const map = L.map('map').setView([20, 0], 2);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

const controlsEl = document.getElementById('controls');

let currentLatLng = null;
let startMarker = null;
let destMarker = null;
let routingControl = null;

function createPlaceButtons() {
  places.forEach(p => {
    const btn = document.createElement('button');
    btn.className = 'place-btn';
    btn.textContent = p.name;
    btn.onclick = () => routeTo(p);
    controlsEl.appendChild(btn);
  });
}
createPlaceButtons();

function routeTo(place) {
  if (!currentLatLng) {
    alert('Current location not available yet. Please allow location access or try again.');
    return;
  }

  const dest = L.latLng(place.lat, place.lng);

  if (destMarker) map.removeLayer(destMarker);
  destMarker = L.marker(dest).addTo(map).bindPopup(place.name).openPopup();

  if (routingControl) {
    map.removeControl(routingControl);
    routingControl = null;
  }

  routingControl = L.Routing.control({
    waypoints: [ currentLatLng, dest ],
    router: L.Routing.osrmv1({
      serviceUrl: 'https://router.project-osrm.org/route/v1' // demo OSRM service
    }),
    lineOptions: { styles: [{ color: 'blue', opacity: 0.7, weight: 6 }] },
    fitSelectedRoutes: true,
    addWaypoints: false,
    draggableWaypoints: false,
    showAlternatives: false
  }).addTo(map);
}

function onLocationSuccess(position) {
  const lat = position.coords.latitude;
  const lng = position.coords.longitude;
  currentLatLng = L.latLng(lat, lng);

  if (startMarker) map.removeLayer(startMarker);
  startMarker = L.marker(currentLatLng).addTo(map).bindPopup('You are here').openPopup();

  map.setView(currentLatLng, 14);
}

function onLocationError(err) {
  console.warn('Geolocation error:', err);
  alert('Could not get location. Make sure location is enabled and you are using HTTPS or localhost. A fallback location will be used.');
  // Optional fallback (change to a sensible default)
  currentLatLng = L.latLng(40.741895, -73.989308);
  if (!startMarker) startMarker = L.marker(currentLatLng).addTo(map).bindPopup('Fallback start').openPopup();
  map.setView(currentLatLng, 13);
}

// Ask the browser for location (needs HTTPS or localhost in most browsers)
if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(onLocationSuccess, onLocationError, { enableHighAccuracy: true, timeout: 10000 });
} else {
  onLocationError({ message: 'Geolocation not supported' });
}
</script>
</body>
</html>
